<!-- pages/profile/index.wxml -->
<view class="page">
  <view class="card">
    <block wx:if="{{!user}}">
      <view class="title">需要微信授权登录</view>
      <view class="desc">点击下方按钮完成授权并绑定账号</view>
      <button class="btn" bindtap="onAuthLoginTap" loading="{{busy}}" disabled="{{busy}}">微信一键授权登录</button>
      <view class="tools">
        <button class="mini" size="mini" bindtap="onCheckTap">检查环境</button>
        <text class="tips">（检查会显示 openid/云环境信息）</text>
      </view>
      <scroll-view class="diag" scroll-y>
        <text selectable="true">{{diag}}</text>
      </scroll-view>
    </block>
    <block wx:else>
      <view class="user">
        <image class="avatar" src="{{user.avatarUrl || '/images/avatar-default.png'}}" />
        <view class="name">{{user.nickName || '微信用户'}}</view>
      </view>
      <button class="mini danger" size="mini" bindtap="onLogoutTap">退出登录</button>
      <view class="tools">
        <button class="mini" size="mini" bindtap="onCheckTap">检查环境</button>
      </view>
      <scroll-view class="diag" scroll-y>
        <text selectable="true">{{diag}}</text>
      </scroll-view>
    </block>
  </view>
</view>
