let ENV_ID=''; try{ ENV_ID=require('../../env.js').ENV_ID||'' }catch(e){}
Page({ data:{ envId:ENV_ID, status:'初始化中…', result:'' }, onLoad(){ this.run() }, async run(){ try{ if(!wx.cloud){ this.setData({ status:'wx.cloud 不存在' }); return } try{ wx.cloud.init({ env: ENV_ID || wx.cloud.DYNAMIC_CURRENT_ENV, traceUser:true }) }catch(e){} this.setData({ status:'调用 whoami…', result:'' }); const r = await wx.cloud.callFunction({ name:'whoami', config: ENV_ID? {env:ENV_ID}:{} }); this.setData({ status:'成功', result: JSON.stringify((r&&r.result)||r) }) }catch(err){ this.setData({ status:'失败', result:(err&&err.errMsg)||(err&&err.message)||String(err) }) } } })
